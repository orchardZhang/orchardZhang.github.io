<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  

  
  <title>Spring学习笔记 | Hexo</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="更新于2020-2-12">
<meta property="og:type" content="article">
<meta property="og:title" content="Spring学习笔记">
<meta property="og:url" content="http://yoursite.com/2020/02/04/Spring%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/index.html">
<meta property="og:site_name" content="Hexo">
<meta property="og:description" content="更新于2020-2-12">
<meta property="og:locale" content="en_US">
<meta property="article:published_time" content="2020-02-04T07:56:00.000Z">
<meta property="article:modified_time" content="2020-02-20T08:21:40.906Z">
<meta property="article:author" content="John Doe">
<meta property="article:tag" content="Spring">
<meta name="twitter:card" content="summary">
  
    <link rel="alternate" href="/atom.xml" title="Hexo" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  
<link rel="stylesheet" href="/css/style.css">

<meta name="generator" content="Hexo 5.0.2"></head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">Hexo</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://yoursite.com"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main"><article id="post-Spring学习笔记" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2020/02/04/Spring%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/" class="article-date">
  <time datetime="2020-02-04T07:56:00.000Z" itemprop="datePublished">2020-02-04</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      Spring学习笔记
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h4 id="更新于2020-2-12"><a href="#更新于2020-2-12" class="headerlink" title="更新于2020-2-12"></a>更新于2020-2-12</h4><a id="more"></a>  
<h5 id="Spring概述"><a href="#Spring概述" class="headerlink" title="Spring概述"></a>Spring概述</h5><p>Spring框架本身具有两个特点：1.IOC （inverse of control）反转控制；2.AOP 面向切面的编程  </p>
<h3 id="IOC"><a href="#IOC" class="headerlink" title="IOC"></a>IOC</h3><ul>
<li>耦合：耦合是指程序相对模块之间的关联的度量，具体就是指对象之间的依赖性，在开发中，有些依赖关系是<br>必须的，而有些依赖关系可以通过优化代码来解除的。比如当业务层调用持久层的时候，业务层必须依赖持久层<br>的接口和实现类，如果此时没有持久层的实现类，则编译不能通过。企业开发的时候有可能是同时开发的，是并<br>行的，而不是串行的，这里就需要优化。    </li>
<li>解决程序耦合的思路：就是通过反射来实例化对象。</li>
<li>工厂模式解耦：在实际开发中我们可以把三层的对象都是用配置文件配置起来，当启动服务器应用加载时，让<br>一个类通过读取配置文件，创建和获取三层对象的类，这个类就成为工厂。在工厂模式中，我们获取对象的方式<br>发生了变化，以往我们获取对象的时候都是采用new的方式，是主动的，现在有个工厂这个中介，我们获取对象<br>的方式就变成被动的。这种思想就是控制反转。</li>
<li>总的来说控制反转就是把创建对象的控制权交给了框架，主要包括了依赖注入和依赖查找。</li>
<li>beanfactory 和applicationContext的区别：beanfactory才是spring容器的顶层接口，<br>applicationcontext是是他的子接口。他们两者的区别在于创建对象的时间点不一样，前者什么时候使用什么<br>时候创建对象，后者只要一度去配置文件，默认情况下就会创建对象</li>
<li>appllicationcontext的接口实现类：<br>ClassPathXmlApplicationContext：<br>它是从类的根路径下加载配置文件 推荐使用这种<br>FileSystemXmlApplicationContext ：<br>它是从磁盘路径上加载配置文件，配置文件可以在磁盘的任意位置。<br>AnnotationConfigApplicationContext:<br>当我们使用注解配置容器对象时，需要使用此类来创建 spring 容器。它用来读取注解。  </li>
<li>bean标签：用于配置对象让spring来创建<br>默认情况下他点用的是类中的无参构造<br>属性：<br>id：给对象在容器中提供一个唯一标识。用于获取对象。<br>class：指定类的全限定类名。用于反射创建对象。默认情况下调用无参构造函数。<br>scope：指定对象的作用范围。单例用singleton 多例用prototype<br>singleton :默认值，单例的.<br>prototype :多例的.<br>request :WEB 项目中,Spring 创建一个 Bean 的对象,将对象存入到 request 域中.<br>session :WEB 项目中,Spring 创建一个 Bean 的对象,将对象存入到 session 域中.<br>global session :WEB 项目中,应用在 Portlet 环境.如果没有 Portlet 环境那么<br>globalSession 相当于 session.<br>init-method：指定类中的初始化方法名称。<br>destroy-method：指定类中销毁方法名称。  </li>
<li>bean的作用范围和生命周期<br>单例对象：一个引用只有一个对象的实例，作用范围是整个引用，生命周期：随容器<br>多例对象：每次访问对象时，都会重新创建对象实例，生命周期：每当使用对象时到对象被java垃圾回收了</li>
<li>实例化bean的三种方式<br>第一种方式：使用默认无参构造函数<br>在默认情况下：<br>它会根据默认无参构造函数来创建类对象。如果 bean 中没有默认无参构造函数，将会创建失败。    <bean id="accountService" class="com.itheima.service.impl.AccountServiceImpl"/>
第二种方式：spring 管理静态工厂-使用静态工厂的方法创建对象

</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;**</span><br><span class="line">* 模拟一个静态工厂，创建业务层实现类</span><br><span class="line">*&#x2F;</span><br><span class="line">public class StaticFactory &#123;</span><br><span class="line">public static IAccountService createAccountService()&#123;</span><br><span class="line">return new AccountServiceImpl();</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&lt;!-- 此种方式是:</span><br><span class="line">使用 StaticFactory 类中的静态方法 createAccountService 创建对象，并存入 spring 容器</span><br><span class="line">id 属性：指定 bean 的 id，用于从容器中获取</span><br><span class="line">class 属性：指定静态工厂的全限定类名</span><br><span class="line">factory-method 属性：指定生产对象的静态方法</span><br><span class="line">--&gt;</span><br><span class="line">&lt;bean id&#x3D;&quot;accountService&quot;</span><br><span class="line">class&#x3D;&quot;com.itheima.factory.StaticFactory&quot;</span><br><span class="line">factory-method&#x3D;&quot;createAccountService&quot;&gt;&lt;&#x2F;bean&gt;</span><br></pre></td></tr></table></figure>

<p>第三种方式：spring 管理实例工厂-使用实例工厂的方法创建对象 </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;**</span><br><span class="line">* 模拟一个实例工厂，创建业务层实现类</span><br><span class="line">* 此工厂创建对象，必须现有工厂实例对象，再调用方法</span><br><span class="line">*&#x2F;</span><br><span class="line">public class InstanceFactory &#123;</span><br><span class="line">public IAccountService createAccountService()&#123;</span><br><span class="line">return new AccountServiceImpl();</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&lt;!-- 此种方式是：</span><br><span class="line">先把工厂的创建交给 spring 来管理。</span><br><span class="line">然后在使用工厂的 bean 来调用里面的方法</span><br><span class="line">factory-bean 属性：用于指定实例工厂 bean 的 id。</span><br><span class="line">factory-method 属性：用于指定实例工厂中创建对象的方法。</span><br><span class="line">--&gt;</span><br><span class="line">&lt;bean id&#x3D;&quot;instancFactory&quot; class&#x3D;&quot;com.itheima.factory.InstanceFactory&quot;&gt;&lt;&#x2F;bean&gt;</span><br><span class="line">&lt;bean id&#x3D;&quot;accountService&quot;</span><br><span class="line"> factory-bean&#x3D;&quot;instancFactory&quot;</span><br><span class="line"> factory-method&#x3D;&quot;createAccountService&quot;&gt;&lt;&#x2F;bean&gt;</span><br></pre></td></tr></table></figure>

<ul>
<li>依赖注入：框架把持久层对象传入业务层，而不用我们去获取</li>
<li>构造函数注入：使用类中的构造函数，给成员变量赋值，这里赋值的操作不是我们自己做，<br>而是通过配置的方式，让spring框架为我们注入</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">public class AccountServiceImpl implements IAccountService &#123;</span><br><span class="line">private String name;</span><br><span class="line">private Integer age;</span><br><span class="line">private Date birthday;</span><br><span class="line">public AccountServiceImpl(String name, Integer age, Date birthday) &#123;</span><br><span class="line">this.name &#x3D; name;</span><br><span class="line">this.age &#x3D; age;</span><br><span class="line">this.birthday &#x3D; birthday;</span><br><span class="line">&#125;</span><br><span class="line">@Override</span><br><span class="line">public void saveAccount() &#123;</span><br><span class="line">System.out.println(name+&quot;,&quot;+age+&quot;,&quot;+birthday);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&lt;!-- 使用构造函数的方式，给 service 中的属性传值</span><br><span class="line">要求：</span><br><span class="line">类中需要提供一个对应参数列表的构造函数。</span><br><span class="line">涉及的标签：</span><br><span class="line">constructor-arg</span><br><span class="line">属性：</span><br><span class="line">index:指定参数在构造函数参数列表的索引位置</span><br><span class="line">type:指定参数在构造函数中的数据类型</span><br><span class="line">name:指定参数在构造函数中的名称 用这个找给谁赋值</span><br><span class="line">&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;上面三个都是找给谁赋值，下面两个指的是赋什么值的&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;</span><br><span class="line">value:它能赋的值是基本数据类型和 String 类型</span><br><span class="line">ref:它能赋的值是其他 bean 类型，也就是说，必须得是在配置文件中配置过的 bean</span><br><span class="line">--&gt;</span><br><span class="line">&lt;bean id&#x3D;&quot;accountService&quot; class&#x3D;&quot;com.itheima.service.impl.AccountServiceImpl&quot;&gt;</span><br><span class="line">&lt;constructor-arg name&#x3D;&quot;name&quot; value&#x3D;&quot;张三&quot;&gt;&lt;&#x2F;constructor-arg&gt;</span><br><span class="line">&lt;constructor-arg name&#x3D;&quot;age&quot; value&#x3D;&quot;18&quot;&gt;&lt;&#x2F;constructor-arg&gt;</span><br><span class="line">&lt;constructor-arg name&#x3D;&quot;birthday&quot; ref&#x3D;&quot;now&quot;&gt;&lt;&#x2F;constructor-arg&gt;</span><br><span class="line">&lt;&#x2F;bean&gt;</span><br><span class="line">&lt;bean id&#x3D;&quot;now&quot; class&#x3D;&quot;java.util.Date&quot;&gt;&lt;&#x2F;bean&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<ul>
<li>set 方法注入：就是在类中提供需要注入成员的set方法</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">public class AccountServiceImpl implements IAccountService &#123;</span><br><span class="line">private String name;</span><br><span class="line">private Integer age;</span><br><span class="line">private Date birthday;</span><br><span class="line">public void setName(String name) &#123;</span><br><span class="line">this.name &#x3D; name;</span><br><span class="line">&#125;</span><br><span class="line">public void setAge(Integer age) &#123;</span><br><span class="line">this.age &#x3D; age;</span><br><span class="line">&#125;</span><br><span class="line">public void setBirthday(Date birthday) &#123;</span><br><span class="line">this.birthday &#x3D; birthday;</span><br><span class="line">&#125;</span><br><span class="line">@Override</span><br><span class="line">public void saveAccount() &#123;</span><br><span class="line">System.out.println(name+&quot;,&quot;+age+&quot;,&quot;+birthday);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&lt;!-- 通过配置文件给 bean 中的属性传值：使用 set 方法的方式</span><br><span class="line">涉及的标签：</span><br><span class="line">property</span><br><span class="line">属性：</span><br><span class="line">name：找的是类中 set 方法后面的部分</span><br><span class="line">ref：给属性赋值是其他 bean 类型的</span><br><span class="line">value：给属性赋值是基本数据类型和 string 类型的</span><br><span class="line">实际开发中，此种方式用的较多。</span><br><span class="line">--&gt;</span><br><span class="line">&lt;bean id&#x3D;&quot;accountService&quot; class&#x3D;&quot;com.itheima.service.impl.AccountServiceImpl&quot;&gt;</span><br><span class="line">&lt;property name&#x3D;&quot;name&quot; value&#x3D;&quot;test&quot;&gt;&lt;&#x2F;property&gt;</span><br><span class="line">&lt;property name&#x3D;&quot;age&quot; value&#x3D;&quot;21&quot;&gt;&lt;&#x2F;property&gt;</span><br><span class="line">&lt;property name&#x3D;&quot;birthday&quot; ref&#x3D;&quot;now&quot;&gt;&lt;&#x2F;property&gt;</span><br><span class="line">&lt;&#x2F;bean&gt;</span><br><span class="line">&lt;bean id&#x3D;&quot;now&quot; class&#x3D;&quot;java.util.Date&quot;&gt;&lt;&#x2F;bean&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<ul>
<li>注入集合属性：就是给类中的集合成员传值，他用的也是set方法注入的方式，只不过变量的数据类<br>型都是集合</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">public class AccountServiceImpl implements IAccountService &#123;</span><br><span class="line">private String[] myStrs;</span><br><span class="line">private List&lt;String&gt; myList;</span><br><span class="line">private Set&lt;String&gt; mySet;</span><br><span class="line">private Map&lt;String,String&gt; myMap;</span><br><span class="line">private Properties myProps;</span><br><span class="line">public void setMyStrs(String[] myStrs) &#123;</span><br><span class="line">this.myStrs &#x3D; myStrs;</span><br><span class="line">&#125;</span><br><span class="line">public void setMyList(List&lt;String&gt; myList) &#123;</span><br><span class="line">this.myList &#x3D; myList;</span><br><span class="line">&#125;</span><br><span class="line">public void setMySet(Set&lt;String&gt; mySet) &#123;</span><br><span class="line">this.mySet &#x3D; mySet;</span><br><span class="line">&#125;</span><br><span class="line">public void setMyMap(Map&lt;String, String&gt; myMap) &#123;</span><br><span class="line">this.myMap &#x3D; myMap;</span><br><span class="line">&#125;</span><br><span class="line">public void setMyProps(Properties myProps) &#123;</span><br><span class="line">this.myProps &#x3D; myProps;</span><br><span class="line">&#125;</span><br><span class="line">@Override</span><br><span class="line">public void saveAccount() &#123;</span><br><span class="line">System.out.println(Arrays.toString(myStrs));</span><br><span class="line">System.out.println(myList);</span><br><span class="line">System.out.println(mySet);</span><br><span class="line">System.out.println(myMap);</span><br><span class="line">System.out.println(myProps);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&lt;!-- 注入集合数据</span><br><span class="line">List 结构的：</span><br><span class="line">array,list,set</span><br><span class="line">Map 结构的</span><br><span class="line">map,entry,props,prop</span><br><span class="line">--&gt;</span><br><span class="line">&lt;bean id&#x3D;&quot;accountService&quot; class&#x3D;&quot;com.itheima.service.impl.AccountServiceImpl&quot;&gt;</span><br><span class="line">&lt;!-- 在注入集合数据时，只要结构相同，标签可以互换 --&gt;</span><br><span class="line">&lt;!-- 给数组注入数据 --&gt;</span><br><span class="line">&lt;property name&#x3D;&quot;myStrs&quot;&gt;</span><br><span class="line">&lt;set&gt;</span><br><span class="line">&lt;value&gt;AAA&lt;&#x2F;value&gt;</span><br><span class="line">&lt;value&gt;BBB&lt;&#x2F;value&gt;</span><br><span class="line">&lt;value&gt;CCC&lt;&#x2F;value&gt;</span><br><span class="line">&lt;&#x2F;set&gt;</span><br><span class="line">&lt;&#x2F;property&gt;</span><br><span class="line">&lt;!-- 注入 list 集合数据 --&gt;</span><br><span class="line">&lt;property name&#x3D;&quot;myList&quot;&gt;</span><br><span class="line">&lt;array&gt;</span><br><span class="line">&lt;value&gt;AAA&lt;&#x2F;value&gt;</span><br><span class="line">&lt;value&gt;BBB&lt;&#x2F;value&gt;</span><br><span class="line">&lt;value&gt;CCC&lt;&#x2F;value&gt;</span><br><span class="line">&lt;&#x2F;array&gt;</span><br><span class="line">&lt;&#x2F;property&gt;</span><br><span class="line">&lt;!-- 注入 set 集合数据 --&gt;</span><br><span class="line">&lt;property name&#x3D;&quot;mySet&quot;&gt;</span><br><span class="line">&lt;list&gt;</span><br><span class="line">&lt;value&gt;AAA&lt;&#x2F;value&gt;</span><br><span class="line">&lt;value&gt;BBB&lt;&#x2F;value&gt;</span><br><span class="line">&lt;value&gt;CCC&lt;&#x2F;value&gt;</span><br><span class="line">&lt;&#x2F;list&gt;</span><br><span class="line">&lt;&#x2F;property&gt;</span><br><span class="line">&lt;!-- 注入 Map 数据 --&gt;</span><br><span class="line">&lt;property name&#x3D;&quot;myMap&quot;&gt;</span><br><span class="line">&lt;props&gt;</span><br><span class="line">&lt;prop key&#x3D;&quot;testA&quot;&gt;aaa&lt;&#x2F;prop&gt;</span><br><span class="line">&lt;prop key&#x3D;&quot;testB&quot;&gt;bbb&lt;&#x2F;prop&gt;</span><br><span class="line">&lt;&#x2F;props&gt;</span><br><span class="line">&lt;&#x2F;property&gt;</span><br><span class="line">&lt;!-- 注入 properties 数据 --&gt;</span><br><span class="line">&lt;property name&#x3D;&quot;myProps&quot;&gt;</span><br><span class="line">&lt;map&gt;</span><br><span class="line">&lt;entry key&#x3D;&quot;testA&quot; value&#x3D;&quot;aaa&quot;&gt;&lt;&#x2F;entry&gt;</span><br><span class="line">&lt;entry key&#x3D;&quot;testB&quot;&gt;</span><br><span class="line">&lt;value&gt;bbb&lt;&#x2F;value&gt;</span><br><span class="line">&lt;&#x2F;entry&gt;</span><br><span class="line">&lt;&#x2F;map&gt;</span><br><span class="line">&lt;&#x2F;property&gt;</span><br><span class="line">&lt;&#x2F;bean&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h6 id="注解"><a href="#注解" class="headerlink" title="注解"></a>注解</h6><ul>
<li>用于创建对象的<br>和XML文件中编写一个bean标签实现的功能是一样的<br>@Component：用于把当前类对象存入spring当中，属性：value：用于指定bean的id，当我<br>@Controller：一般用于表现层<br>@Service一般用于业务层<br>@Repository一般用于持久层<br>作用和属性与component是一致的，是spring框架为我们提供明确的三层使用的注解，使我们的三层对象更加清晰。<br>不写的时候，默认值是当前类名，首字母改小写。</li>
<li>用于注入数据的<br>和XML文件中一个bean标签中写一个property是一样的<br>@Autowrited:自动按照类型注入，只要容器中有唯一的一个bean对象类型和要注入的变量类型匹配，就可以注入成功<br>如果在ioc容器中没有找到对应的数据类型，则直接报错，当出现两个或两个以上相同数据类型的变量，如果存在变量名<br>和bean的id相同，则注入成功，否则依旧是注入失败。<br>出现位置：可以是放在变量上，也可以在方法上。<br>@Qualifier 作用：在按照类中注入的基础之上在按照名称注入，他在给类成员注入时不能单独使用，但是在给方法参<br>数注入时，就可以。就是在和类成员注入时要和autowired组合在一起<br>属性：value：用于指定注入bean的id<br>@Resource 作用：直接按照bean的id注入，可以独立使用。<br>属性：name：用于指定bean的id<br>以上三种的注入方式只能注入其他bean类型的数据，而基本类型和string类型的数据不能使用上面三个来实现<br>另外，集合类型的注入只能通过xml来实现。<br>@Value：用于基本类型和String类型的数据<br>属性：value，用于指定数据的值，它可以使用spring中的spEL（也就是spring当中的EL表达式）<br>spEL的写法：${表达式}</li>
<li>用于改变作用范围的<br>和XML文件中一个bean标签中使用scope属性现实的功能是一样的<br>@Scope:作用:指定bean的作用范围，属性：value：指定范围的取值，常用取值：singleton prototype，默认为singleton</li>
<li>和生命周期相关的<br>和xml文件中bean标签init-method和destroy-method是一样的<br>@preDestroy：用于指定销毁方法，<br>@PostConstruct：用于指定初始化方法  </li>
<li>Spring中的新注解<br>@Configuration ：指定当前类是一个配置类；当配置类作为AnnotationConfigApplicationContext对象创建的参数时，注解可以不写<br>@ComponentScan ：通过注解指定spring在创建容器时要扫描的包。属性：basePackages = “包名”;<br>@Bean : 用于把当前方法的返回值作为bean对象存入spring的ioc对象容器中。属性：name：用于指定bean的id，当不写的<br>时候，默认值是当前方法的名称。<br>当我们使用注解配置方法时，如果方法有参数，spring框架会去容器中查找有没有可用的bean对象，查找方法和Autowried注解的作用时一样的<br>@Import：用于导入其他的配置类，写在主配置类下，括号内写入副配置类的.class文件。属性value：用于指定其他配置类的字节码。<br>@PropertySource：用于指定properties文件的位置，属性：value：指定文件的名称和路径关键字classpath：表示类路径下</li>
</ul>
<h5 id="使用junit单元测试"><a href="#使用junit单元测试" class="headerlink" title="使用junit单元测试"></a>使用junit单元测试</h5><ul>
<li>导入spring整合junit的jar坐标</li>
<li>使用junit提供的一个注解把原有的main方法替换了，替换成spring提供的。 @Runwith</li>
<li>告知spring的运行期，spring和ioc创建是基于xml还是注解，并说明位置<br>@ContextConfiguration 属性：Location:指定xml文件的位置，加上classpath关键字，表示在类路径，classes：<br>指定注解类（替代xml的类）所在的位置</li>
<li>使用spring5.x 要求junit的版本不低于4.1.2</li>
</ul>
<h3 id="AOP"><a href="#AOP" class="headerlink" title="AOP"></a>AOP</h3><h5 id="动态代理"><a href="#动态代理" class="headerlink" title="动态代理"></a>动态代理</h5><ul>
<li>字节码文件随用随创建，随用随加载，不修改原码的基础上对方法增强。</li>
<li>分类：基于接口的动态代理；基于子类的动态代理；</li>
<li>基于接口的动态代理：涉及的类：proxy；提供者：JDK官方；</li>
<li>如何创建动态代理对象：使用proxy类中的newProxyInstance方法</li>
<li>创建代理对象的要求：被代理最少实现一个接口。如果没有则不能使用</li>
<li>newProxyInstance方法的参数：<br>ClassLoader 加载代理对象字节码，写的是被代理对象的类加载器,<br>Class[] 用于让代理对象和被代理对象有相同的方法,<br>InvocationHandler：用于提供增强的代码，他是我们写如何代理，我们一般都是写一个该接口的实现类<br>通常情况下都是匿名内部类，但不必须此接口的实现类都是谁用谁写,  </li>
<li>基于子类的动态代理：涉及的类：Enhancer，提供者：第三方cglib库。</li>
<li>如何创建代理对象：Enhancer类中的create方法</li>
<li>创建代理对象的要求：被代理类不能是最终类final</li>
<li>create方法的参数：class：字节码，用于指定被代理对象的字节码，Callback：用于提供增强的代码，我们一般写的都是<br>该接口的子接口实现类：MethodInterceptor（）用于方法拦截。<h5 id="AOP-1"><a href="#AOP-1" class="headerlink" title="AOP"></a>AOP</h5></li>
<li>面向切面编程，通过预编译的方式和运行期动态代理实现程序功能的统一维护的一种技术，<br>简单说他就是把我们程序的重复代码提取出来，在需要执行的时候，使用动态代理技术，在不<br>修改原码的基础上，对我们的已有方法进行增强</li>
<li>减少重复代码，提高开发效率，维护方便<h5 id="spring中AOP相关术语"><a href="#spring中AOP相关术语" class="headerlink" title="spring中AOP相关术语"></a>spring中AOP相关术语</h5></li>
<li>Joinpoint连接点：业务层中的方法。连接点就是那些被拦截到的点。在spring中，这些点指的是方法，因为spring只支持方法类型的连接点</li>
<li>Pointcut切入点：，被增强的方法。业务层中可能有一些方法没有被增强，就只是连接点，不是切入点。切入点是指我们要对那些Joinpoint进行拦截的定义</li>
<li>Advice通知/增强：提供了公共代码的类。拦截到joinpooint之后所要做的事情就是通知，有几种类型：前置通知，后置通知，异常通知，最终通知，环绕通知；<br>整个invoke方法在执行就是环绕通知，环绕通知是spring框架为我们提供的一种可以在代码中手动增强方法何时执行的方式。，当中调用的业务层方法就是切入点，在代码逻辑上，先于切入点就是前置通知，后于切入点就是后置通知，在catch里面就是异常通知，在finally里面就是最终通知。</li>
<li>Introduction 引介：一种在不修改类代码的前提下的通知，可以在运行期为类动态地添加一些方法或Field</li>
<li>Target目标对象：代理的目标对象，就是被代理对象</li>
<li>Weaving织入：指把增强应用到目标对象来创建新的代理对象的过程，spring采用动态代理织入，而AspectJ采用织入和类装载期织入</li>
<li>Proxy：代理：一个类被AOP织入增强后，就产生一个结果代理类</li>
<li>Aspect切面：是切入点和通知（引介）的结合。</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version&#x3D;&quot;1.0&quot; encoding&#x3D;&quot;UTF-8&quot;?&gt;</span><br><span class="line">&lt;beans xmlns&#x3D;&quot;http:&#x2F;&#x2F;www.springframework.org&#x2F;schema&#x2F;beans&quot;</span><br><span class="line">       xmlns:xsi&#x3D;&quot;http:&#x2F;&#x2F;www.w3.org&#x2F;2001&#x2F;XMLSchema-instance&quot;</span><br><span class="line">       xmlns:aop&#x3D;&quot;http:&#x2F;&#x2F;www.springframework.org&#x2F;schema&#x2F;aop&quot;</span><br><span class="line">       xsi:schemaLocation&#x3D;&quot;http:&#x2F;&#x2F;www.springframework.org&#x2F;schema&#x2F;beans</span><br><span class="line">        http:&#x2F;&#x2F;www.springframework.org&#x2F;schema&#x2F;beans&#x2F;spring-beans.xsd</span><br><span class="line">        http:&#x2F;&#x2F;www.springframework.org&#x2F;schema&#x2F;aop</span><br><span class="line">        http:&#x2F;&#x2F;www.springframework.org&#x2F;schema&#x2F;aop&#x2F;spring-aop.xsd&quot;&gt;</span><br><span class="line"></span><br><span class="line">    &lt;!--配置soring的ioc，把service对象配置进来--&gt;</span><br><span class="line">&lt;bean id&#x3D;&quot;accountService&quot;   class&#x3D;&quot;com.itheima.service.impl.AccountServiceImpl&quot;&gt;&lt;&#x2F;bean&gt;</span><br><span class="line">    &lt;!--spring中基于xml的AOP配置</span><br><span class="line">    1.把通知Bean也交给spring来管理</span><br><span class="line">    2.使用aop:config标签表明开始AOP的配置</span><br><span class="line">    3.使用aop:aspect标签表明配置切面</span><br><span class="line">            id属性：是给切面提供一个唯一标识</span><br><span class="line">            ref属性：是指通知类（公共代码）bean的id</span><br><span class="line">     4.在aop:aspect标签内部使用对应标签来配置通知的类型</span><br><span class="line">            我们现在的示例是让printlog方法在切入点方法执行之前。即为前置通知</span><br><span class="line">            aop:before表示配置前置通知</span><br><span class="line">                method属性：用于指定Logger类中哪个方法是前置通知</span><br><span class="line">                pointcut属性：用于指定切入点表达式，该表达式的含义指的是对业务层中那些方法增强</span><br><span class="line"></span><br><span class="line">            切入点表达式的写法</span><br><span class="line">                关键字：execution(表达式)</span><br><span class="line">                标准表达式；</span><br><span class="line">                    访问修饰符 返回值 包名，包名，包名。。。类名.方法名(参数列表)</span><br><span class="line">                    例如：</span><br><span class="line">                 public void com.itheima.service.impl.AccountServiceImpl.saveAccount();</span><br><span class="line">                 访问修饰符可以省略</span><br><span class="line">                 void com.itheima.service.impl.AccountServiceImpl.saveAccount();</span><br><span class="line">                 返回值可以使用通配符，表示任意返回值</span><br><span class="line">                 * com.itheima.service.impl.AccountServiceImpl.saveAccount();</span><br><span class="line">                 包名可以使用通配符，表示任意包，但是有几级包就得要求要有几个通配符</span><br><span class="line">                 * *.*.*.*.AccountSerciceImpl.saveAccount();</span><br><span class="line">                 包名可以使用..表示当前包及其子包</span><br><span class="line">                 * *..AccountSerciceImpl.saveAccount();</span><br><span class="line">                 类名和方法名都可以使用*统配</span><br><span class="line">                 * *..*.*();</span><br><span class="line">                 参数列表可以直接写数据类型</span><br><span class="line">                    基本类型写名称  int</span><br><span class="line">                    引用类型写包名.类名的方式 java.lang.String</span><br><span class="line">                    可以使用通配符*来表示任意类型的参数，但是，前提是方法必须有参数</span><br><span class="line">                    可以使用..表示有无参数类型，有无参数均可，有参数是任意类型</span><br><span class="line">                  全通配写法：</span><br><span class="line">                    * *..*.*(..);</span><br><span class="line"></span><br><span class="line">             实际开发中切入点表达式的通常写法</span><br><span class="line">                切到业务层实现类下的所有方法</span><br><span class="line">                    例如： com.itheima.service.impl.*.*(..);</span><br><span class="line">    --&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&lt;!--    配置Logger类   公共代码部分，用于增强业务层代码--&gt;</span><br><span class="line">    &lt;bean id&#x3D;&quot;logger&quot; class&#x3D;&quot;com.itheima.utils.Logger&quot;&gt;&lt;&#x2F;bean&gt;</span><br><span class="line">&lt;!--配置AOP--&gt;</span><br><span class="line">&lt;aop:config&gt;</span><br><span class="line">&lt;!--    配置切面--&gt;</span><br><span class="line">    &lt;aop:aspect id&#x3D;&quot;logAdvice&quot; ref&#x3D;&quot;logger&quot;&gt;</span><br><span class="line">&lt;!--        配置通知的类型，并且建立通知方法和切入方法的关联--&gt;</span><br><span class="line">        &lt;aop:before method&#x3D;&quot;printLog&quot; pointcut&#x3D;&quot;execution(public void com.itheima.service.impl.AccountServiceImpl.saveAccount())&quot;&gt;&lt;&#x2F;aop:before&gt;</span><br><span class="line">    &lt;&#x2F;aop:aspect&gt;</span><br><span class="line"></span><br><span class="line">&lt;&#x2F;aop:config&gt;</span><br><span class="line"></span><br><span class="line">&lt;&#x2F;beans&gt;    </span><br><span class="line"></span><br></pre></td></tr></table></figure>

<ul>
<li>四种通知类型</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">    &lt;!--配置AOP--&gt;</span><br><span class="line">&lt;aop:config&gt;</span><br><span class="line">&lt;!--    配置切面--&gt;</span><br><span class="line">    &lt;aop:aspect id&#x3D;&quot;logAdvice&quot; ref&#x3D;&quot;logger&quot;&gt;</span><br><span class="line">&lt;!--        配置通知的类型，并且建立通知方法和切入方法的关联--&gt;</span><br><span class="line">&lt;!--        前置通知--&gt;</span><br><span class="line">        &lt;aop:before method&#x3D;&quot;beforePrintLog&quot; pointcut&#x3D;&quot;execution(* com.itheima.service.impl.*.*(..))&quot;&gt;&lt;&#x2F;aop:before&gt;</span><br><span class="line">&lt;!--        后置通知--&gt;</span><br><span class="line">        &lt;aop:after-returning method&#x3D;&quot;afterReturningPrintLog&quot; pointcut&#x3D;&quot;execution(* com.itheima.service.impl.*.*(..))&quot;&gt;&lt;&#x2F;aop:after-returning&gt;</span><br><span class="line">&lt;!--        异常通知--&gt;</span><br><span class="line">        &lt;aop:after-throwing method&#x3D;&quot;afterThrowingPrintLog&quot; pointcut&#x3D;&quot;execution(* com.itheima.service.impl.*.*(..))&quot;&gt;&lt;&#x2F;aop:after-throwing&gt;</span><br><span class="line">&lt;!--        最终通知--&gt;</span><br><span class="line">        &lt;aop:after method&#x3D;&quot;afterPrintLog&quot; pointcut&#x3D;&quot;execution(* com.itheima.service.impl.*.*(..))&quot;&gt;&lt;&#x2F;aop:after&gt;</span><br><span class="line"></span><br><span class="line">    &lt;&#x2F;aop:aspect&gt;</span><br><span class="line"></span><br><span class="line">&lt;&#x2F;aop:config&gt;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<ul>
<li>对于重复execution的改进</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">&lt;!--配置AOP--&gt;</span><br><span class="line">&lt;aop:config&gt;</span><br><span class="line">&lt;!--    配置切面--&gt;</span><br><span class="line">    &lt;aop:aspect id&#x3D;&quot;logAdvice&quot; ref&#x3D;&quot;logger&quot;&gt;</span><br><span class="line">&lt;!--        配置通知的类型，并且建立通知方法和切入方法的关联--&gt;</span><br><span class="line">&lt;!--        前置通知--&gt;</span><br><span class="line">        &lt;aop:before method&#x3D;&quot;beforePrintLog&quot; pointcut-ref&#x3D;&quot;pt1&quot; &gt;&lt;&#x2F;aop:before&gt;</span><br><span class="line">&lt;!--        后置通知--&gt;</span><br><span class="line">        &lt;aop:after-returning method&#x3D;&quot;afterReturningPrintLog&quot; pointcut-ref&#x3D;&quot;pt1&quot;&gt;&lt;&#x2F;aop:after-returning&gt;</span><br><span class="line">&lt;!--        异常通知--&gt;</span><br><span class="line">        &lt;aop:after-throwing method&#x3D;&quot;afterThrowingPrintLog&quot; pointcut-ref&#x3D;&quot;pt1&quot;&gt;&lt;&#x2F;aop:after-throwing&gt;</span><br><span class="line">&lt;!--        最终通知--&gt;</span><br><span class="line">        &lt;aop:after method&#x3D;&quot;afterPrintLog&quot; pointcut-ref&#x3D;&quot;pt1&quot;&gt;&lt;&#x2F;aop:after&gt;</span><br><span class="line"></span><br><span class="line">&lt;!--        配置切入点表达式  id属性用于指定表达式的唯一表示</span><br><span class="line">            此标签写在aop：aspect标签内部只能当前切面使用。</span><br><span class="line">            他还可以写在aop：aspect外面，此时变成了所有切面可用</span><br><span class="line">            但是这里注意，必须写在设置切面之前</span><br><span class="line">--&gt;</span><br><span class="line">        &lt;aop:pointcut id&#x3D;&quot;pt1&quot; expression&#x3D;&quot;execution(* com.itheima.service.impl.*.*(..))&quot;&#x2F;&gt;</span><br><span class="line">&lt;!--        配置环绕通知 详细的注释在logger类中</span><br><span class="line">            环绕通知有个问题：当我们配置好了环绕通知后，切入点方法没有执行，而通知方法执行了</span><br><span class="line">        分析：</span><br><span class="line">            对比动态代理中的环绕通知代码，发现动态代理中的环绕通知有明确的切入点方法调用，而我们的没有</span><br><span class="line">        解决：</span><br><span class="line">            spring框架为我们提供了一个接口，ProceedingJoinPoint，该接口有一个方法proceed（），此方</span><br><span class="line">            法相当于明确调用切入点的方法。该接口可以作为环绕通知的方法参数，程序执行时，spring框架会为</span><br><span class="line">            我们提供该接口的实现类供我们使用。</span><br><span class="line">--&gt;</span><br><span class="line">        &lt;aop:around method&#x3D;&quot;aroundPrintLog&quot; pointcut-ref&#x3D;&quot;pt1&quot; &gt;&lt;&#x2F;aop:around&gt;</span><br><span class="line">    &lt;&#x2F;aop:aspect&gt;</span><br><span class="line">&lt;&#x2F;aop:config&gt;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h5 id="基于注解的AOP"><a href="#基于注解的AOP" class="headerlink" title="基于注解的AOP"></a>基于注解的AOP</h5><ul>
<li><p>xml文件</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version&#x3D;&quot;1.0&quot; encoding&#x3D;&quot;UTF-8&quot;?&gt;</span><br><span class="line">&lt;beans xmlns&#x3D;&quot;http:&#x2F;&#x2F;www.springframework.org&#x2F;schema&#x2F;beans&quot;</span><br><span class="line">       xmlns:xsi&#x3D;&quot;http:&#x2F;&#x2F;www.w3.org&#x2F;2001&#x2F;XMLSchema-instance&quot;</span><br><span class="line">       xmlns:aop&#x3D;&quot;http:&#x2F;&#x2F;www.springframework.org&#x2F;schema&#x2F;aop&quot;</span><br><span class="line">       xmlns:context&#x3D;&quot;http:&#x2F;&#x2F;www.springframework.org&#x2F;schema&#x2F;context&quot;</span><br><span class="line">       xsi:schemaLocation&#x3D;&quot;http:&#x2F;&#x2F;www.springframework.org&#x2F;schema&#x2F;beans</span><br><span class="line">        http:&#x2F;&#x2F;www.springframework.org&#x2F;schema&#x2F;beans&#x2F;spring-beans.xsd</span><br><span class="line">        http:&#x2F;&#x2F;www.springframework.org&#x2F;schema&#x2F;aop</span><br><span class="line">        http:&#x2F;&#x2F;www.springframework.org&#x2F;schema&#x2F;aop&#x2F;spring-aop.xsd</span><br><span class="line">        http:&#x2F;&#x2F;www.springframework.org&#x2F;schema&#x2F;context</span><br><span class="line">        http:&#x2F;&#x2F;www.springframework.org&#x2F;schema&#x2F;context&#x2F;spring-context.xsd&quot;&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&lt;!--    配置spring创建容器时要扫描的包--&gt;</span><br><span class="line">&lt;context:component-scan base-package&#x3D;&quot;com.itheima&quot;&gt;&lt;&#x2F;context:component-scan&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&lt;!--配置spring开始注解AOP的支持--&gt;</span><br><span class="line">&lt;aop:aspectj-autoproxy&gt;&lt;&#x2F;aop:aspectj-autoproxy&gt;</span><br><span class="line">&lt;&#x2F;beans&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
</li>
<li><p>业务层</p>
</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">package com.itheima.utils;</span><br><span class="line"></span><br><span class="line">import org.aspectj.lang.ProceedingJoinPoint;</span><br><span class="line">import org.aspectj.lang.annotation.*;</span><br><span class="line">import org.springframework.stereotype.Component;</span><br><span class="line"></span><br><span class="line">&#x2F;**</span><br><span class="line"> * 用于记录日志的工具类，它里面提供了公共代码</span><br><span class="line"> *</span><br><span class="line"> *&#x2F;</span><br><span class="line">@Component(&quot;logger&quot;)</span><br><span class="line">@Aspect&#x2F;&#x2F;表示当前类是一个切面类</span><br><span class="line">public class Logger &#123;</span><br><span class="line">    @Pointcut(&quot;execution(* com.itheima.service.impl.*.*(..))&quot;)</span><br><span class="line">    private void pt1()&#123; &#125;</span><br><span class="line"></span><br><span class="line">    &#x2F;**</span><br><span class="line">     * 前置通知</span><br><span class="line">     *&#x2F;</span><br><span class="line">    @Before(&quot;pt1()&quot;)</span><br><span class="line">    public void beforePrintLog()&#123;</span><br><span class="line">        System.out.println(&quot;Logger类中的beforePrintLog方法开始记录日记了&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">    &#x2F;**</span><br><span class="line">     * 后置通知</span><br><span class="line">     *&#x2F;</span><br><span class="line">    @AfterReturning(&quot;pt1()&quot;)</span><br><span class="line">    public void afterReturningPrintLog()&#123;</span><br><span class="line">        System.out.println(&quot;Logger类中的afterReturningPrintLog方法开始记录日记了&quot;);</span><br><span class="line">    &#125;   &#x2F;**</span><br><span class="line">     * 异常通知</span><br><span class="line">     *&#x2F;</span><br><span class="line">    @AfterThrowing(&quot;pt1()&quot;)</span><br><span class="line">    public void afterThrowingPrintLog()&#123;</span><br><span class="line">        System.out.println(&quot;Logger类中的afterThrowingPrintLog方法开始记录日记了&quot;);</span><br><span class="line">    &#125;   &#x2F;**</span><br><span class="line">     * 最终通知</span><br><span class="line">     *&#x2F;</span><br><span class="line">    @After(&quot;pt1()&quot;)</span><br><span class="line">    public void afterPrintLog()&#123;</span><br><span class="line">        System.out.println(&quot;Logger类中的afterPrintLog方法开始记录日记了&quot;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    &#x2F;**</span><br><span class="line">     * 环绕通知</span><br><span class="line">     *&#x2F;</span><br><span class="line">    public void aroundPrintLog()&#123;</span><br><span class="line">        System.out.println(&quot;Logger类中的aroundPrintLog方法开始记录日记了&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">    &#x2F;&#x2F;@Around(&quot;pt1()&quot;) 与上面四个注解是不能同时存在的。</span><br><span class="line">    public Object aroundPrintLog(ProceedingJoinPoint pjp)&#123;</span><br><span class="line">        Object rtValue &#x3D; null;</span><br><span class="line">        try &#123;</span><br><span class="line">            Object[] args &#x3D; pjp.getArgs();</span><br><span class="line">            pjp.proceed(args);&#x2F;&#x2F;明确调用业务层方法（切入点方法）</span><br><span class="line">            return rtValue;</span><br><span class="line">        &#125; catch (Throwable throwable) &#123;</span><br><span class="line">            throw new RuntimeException(throwable);</span><br><span class="line">        &#125;finally &#123;</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>非环绕通知的注解spring在执行顺序上会有问题，会先执行最终通知，然后在执行后置通知。但是我们用环绕通知就可以解决这个问题。</li>
</ul>
<h4 id="JdbcTemplate"><a href="#JdbcTemplate" class="headerlink" title="JdbcTemplate"></a>JdbcTemplate</h4><ul>
<li>作用：用于和数据库交互，实现对表的CRUD操作</li>
<li>jdbctemplateCRUD操作</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">package com.itheima.jdbctemplate;</span><br><span class="line"></span><br><span class="line">import com.itheima.domain.Account;</span><br><span class="line">import org.springframework.context.ApplicationContext;</span><br><span class="line">import org.springframework.context.support.ClassPathXmlApplicationContext;</span><br><span class="line">import org.springframework.jdbc.core.BeanPropertyRowMapper;</span><br><span class="line">import org.springframework.jdbc.core.JdbcTemplate;</span><br><span class="line">import org.springframework.jdbc.core.RowMapper;</span><br><span class="line"></span><br><span class="line">import java.sql.ResultSet;</span><br><span class="line">import java.sql.SQLException;</span><br><span class="line">import java.util.List;</span><br><span class="line"></span><br><span class="line">&#x2F;**</span><br><span class="line"> * JdbcTemplate基本用法</span><br><span class="line"> *&#x2F;</span><br><span class="line">public class JdbcTemplateDemo &#123;</span><br><span class="line">    public static void main(String[] args) &#123;</span><br><span class="line">        &#x2F;&#x2F;1.获取容器</span><br><span class="line">        ApplicationContext ac &#x3D; new ClassPathXmlApplicationContext(&quot;bean.xml&quot;);</span><br><span class="line">        &#x2F;&#x2F;2.获取对象</span><br><span class="line">        JdbcTemplate jt &#x3D; ac.getBean(&quot;jdbcTemplate&quot;,JdbcTemplate.class);</span><br><span class="line">        &#x2F;&#x2F;3.执行操作</span><br><span class="line">        &#x2F;&#x2F;保存</span><br><span class="line">        jt.update(&quot;insert into account(name,money)values (?,?)&quot;,&quot;ccccc&quot;,333);</span><br><span class="line">        &#x2F;&#x2F;更新</span><br><span class="line">        jt.update(&quot;update account set name &#x3D;?,money&#x3D;? where id&#x3D;?&quot;, &quot;update&quot;,121321,3);</span><br><span class="line">        &#x2F;&#x2F;删除</span><br><span class="line">        jt.update(&quot;delete from account where id &#x3D;?&quot;, 9);</span><br><span class="line">        &#x2F;&#x2F;查询所有</span><br><span class="line">        &#x2F;&#x2F; List&lt;Account&gt; accounts &#x3D;jt.query(&quot;select * from account where money &gt;?&quot;,new AccountRowMapper(),1000f);</span><br><span class="line">        List&lt;Account&gt; accounts &#x3D;jt.query(&quot;select * from account where money &gt;?&quot;,new BeanPropertyRowMapper&lt;Account&gt;(Account.class),10f);</span><br><span class="line">        for (Account account : accounts) &#123;</span><br><span class="line">            System.out.println(account);</span><br><span class="line">        &#125;</span><br><span class="line">        &#x2F;&#x2F;查询一个</span><br><span class="line">        List&lt;Account&gt; accounts1 &#x3D;jt.query(&quot;select * from account where id&#x3D;?&quot;,new BeanPropertyRowMapper&lt;Account&gt;(Account.class),-1);</span><br><span class="line">        System.out.println(accounts1.isEmpty()? &quot;未查询到该内容&quot;:accounts1.get(0));</span><br><span class="line">        &#x2F;&#x2F;查询返回一行一列</span><br><span class="line">        Long count &#x3D; jt.queryForObject(&quot;select count(*) from account where money &#x3D; ?&quot;, long.class, 1000f);</span><br><span class="line">        System.out.println(count);</span><br><span class="line">        </span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#x2F;**</span><br><span class="line"> * 定义Account的封装策略</span><br><span class="line"> *&#x2F;</span><br><span class="line">class AccountRowMapper implements RowMapper&lt;Account&gt;&#123;</span><br><span class="line">    &#x2F;**</span><br><span class="line">     * 把结果集中的数据封装到Account中，然后由spring把每个Account加到集合中。</span><br><span class="line">     * @param rs</span><br><span class="line">     * @param rowNum</span><br><span class="line">     * @return</span><br><span class="line">     * @throws SQLException</span><br><span class="line">     *&#x2F;</span><br><span class="line">    public Account mapRow(ResultSet rs, int rowNum) throws SQLException &#123;</span><br><span class="line">        Account account &#x3D; new Account();</span><br><span class="line">        account.setId(rs.getInt(&quot;id&quot;));</span><br><span class="line">        account.setName(rs.getString(&quot;name&quot;));</span><br><span class="line">        account.setMoney(rs.getFloat(&quot;money&quot;));</span><br><span class="line">        return account;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>


<h4 id="Spring中事务控制的API"><a href="#Spring中事务控制的API" class="headerlink" title="Spring中事务控制的API"></a>Spring中事务控制的API</h4><ul>
<li>spring基于xml的声明式事务控制</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">&lt;?xml version&#x3D;&quot;1.0&quot; encoding&#x3D;&quot;UTF-8&quot;?&gt;</span><br><span class="line">&lt;beans xmlns&#x3D;&quot;http:&#x2F;&#x2F;www.springframework.org&#x2F;schema&#x2F;beans&quot;</span><br><span class="line">       xmlns:xsi&#x3D;&quot;http:&#x2F;&#x2F;www.w3.org&#x2F;2001&#x2F;XMLSchema-instance&quot;</span><br><span class="line">       xmlns:aop&#x3D;&quot;http:&#x2F;&#x2F;www.springframework.org&#x2F;schema&#x2F;aop&quot;</span><br><span class="line">       xmlns:tx&#x3D;&quot;http:&#x2F;&#x2F;www.springframework.org&#x2F;schema&#x2F;tx&quot;</span><br><span class="line">       xsi:schemaLocation&#x3D;&quot;</span><br><span class="line">        http:&#x2F;&#x2F;www.springframework.org&#x2F;schema&#x2F;beans</span><br><span class="line">        http:&#x2F;&#x2F;www.springframework.org&#x2F;schema&#x2F;beans&#x2F;spring-beans.xsd</span><br><span class="line">        http:&#x2F;&#x2F;www.springframework.org&#x2F;schema&#x2F;tx</span><br><span class="line">        http:&#x2F;&#x2F;www.springframework.org&#x2F;schema&#x2F;tx&#x2F;spring-tx.xsd</span><br><span class="line">        http:&#x2F;&#x2F;www.springframework.org&#x2F;schema&#x2F;aop</span><br><span class="line">        http:&#x2F;&#x2F;www.springframework.org&#x2F;schema&#x2F;aop&#x2F;spring-aop.xsd&quot;&gt;</span><br><span class="line"></span><br><span class="line">    &lt;!-- 配置账户的持久层--&gt;</span><br><span class="line">    &lt;bean id&#x3D;&quot;accountDao&quot; class&#x3D;&quot;com.itheima.dao.impl.AccountDaoImpl&quot;&gt;</span><br><span class="line">        &lt;!--&lt;property name&#x3D;&quot;jdbcTemplate&quot; ref&#x3D;&quot;jdbcTemplate&quot;&gt;&lt;&#x2F;property&gt;--&gt;</span><br><span class="line">        &lt;property name&#x3D;&quot;dataSource&quot; ref&#x3D;&quot;dataSource&quot;&gt;&lt;&#x2F;property&gt;</span><br><span class="line">    &lt;&#x2F;bean&gt;</span><br><span class="line"></span><br><span class="line">&lt;!--配置业务层--&gt;</span><br><span class="line">    &lt;bean id&#x3D;&quot;accountService&quot; class&#x3D;&quot;com.itheima.service.impl.AccountServiceImpl&quot;&gt;</span><br><span class="line">        &lt;property name&#x3D;&quot;accountDao&quot; ref&#x3D;&quot;accountDao&quot;&gt;&lt;&#x2F;property&gt;</span><br><span class="line">    &lt;&#x2F;bean&gt;</span><br><span class="line"></span><br><span class="line">    &lt;!-- 配置数据源--&gt;</span><br><span class="line">    &lt;bean id&#x3D;&quot;dataSource&quot; class&#x3D;&quot;org.springframework.jdbc.datasource.DriverManagerDataSource&quot;&gt;</span><br><span class="line">        &lt;property name&#x3D;&quot;driverClassName&quot; value&#x3D;&quot;com.mysql.jdbc.Driver&quot;&gt;&lt;&#x2F;property&gt;</span><br><span class="line">        &lt;property name&#x3D;&quot;url&quot; value&#x3D;&quot;jdbc:mysql:&#x2F;&#x2F;localhost:3306&#x2F;eesy&quot;&gt;&lt;&#x2F;property&gt;</span><br><span class="line">        &lt;property name&#x3D;&quot;username&quot; value&#x3D;&quot;root&quot;&gt;&lt;&#x2F;property&gt;</span><br><span class="line">        &lt;property name&#x3D;&quot;password&quot; value&#x3D;&quot;root&quot;&gt;&lt;&#x2F;property&gt;</span><br><span class="line">    &lt;&#x2F;bean&gt;</span><br><span class="line"></span><br><span class="line">&lt;!--    spring中基于xml的声明式事务控制配置步骤</span><br><span class="line">1.配置事务管理器</span><br><span class="line">2.配置事务的通知</span><br><span class="line">    此时我们需要导入事务的约束 tx的名称空间和约束</span><br><span class="line">    使用tx:advice标签配置事务通知</span><br><span class="line">        属性：</span><br><span class="line">            id：给事务通知一个唯一标识</span><br><span class="line">            transaction-manager:给事务通知提供一个事务管理器的引用</span><br><span class="line">3.配置AOP中的通用切入点表达式</span><br><span class="line">4.建立事务通知和切入点表达式的对应关系</span><br><span class="line">5.配置事务的属性</span><br><span class="line">    在事务的通知tx:advcie标签内部</span><br><span class="line"></span><br><span class="line">--&gt;</span><br><span class="line">&lt;!--配置事务管理器--&gt;</span><br><span class="line">&lt;bean id&#x3D;&quot;transactionManager&quot; class&#x3D;&quot;org.springframework.jdbc.datasource.DataSourceTransactionManager&quot;&gt;</span><br><span class="line">    &lt;property name&#x3D;&quot;dataSource&quot; ref&#x3D;&quot;dataSource&quot;&gt;&lt;&#x2F;property&gt;</span><br><span class="line">&lt;&#x2F;bean&gt;</span><br><span class="line"></span><br><span class="line">&lt;!--    配置事务的通知--&gt;</span><br><span class="line">    &lt;tx:advice id&#x3D;&quot;txAdvice&quot; transaction-manager&#x3D;&quot;transactionManager&quot;&gt;</span><br><span class="line">&lt;!--        配置事务的属性</span><br><span class="line">            isolation:用于指定事务的隔离级别，默认值是default，表示使用数据库的默认隔离级别</span><br><span class="line">            propagation：用于指定事务的传播行为，默认值是REQUIRED，表示一定会有事务，增删改的选择。查询方法可以选择SUPPORTS。</span><br><span class="line">            read-only:用于指定事务是否只读。只有查询方法才能设置为true</span><br><span class="line">            timeout：用于指定事务的超时时间，默认值是-1，表示永不超时，如果制定了数值，以秒为单位</span><br><span class="line">            rollback-for：用于指定一个异常，当产生该异常时，事务回滚，其他异常不回滚，没有默认值，表示所有异常都回滚</span><br><span class="line">            no-rollback-for：用于指定一个异常，当产生该异常时，事务不回滚，其他异常回滚，没有默认值，表示任何异常都回滚。</span><br><span class="line"></span><br><span class="line">--&gt;</span><br><span class="line">        &lt;tx:attributes&gt;</span><br><span class="line">            &lt;tx:method name&#x3D;&quot;*&quot; propagation&#x3D;&quot;REQUIRED&quot; read-only&#x3D;&quot;false&quot;&gt;&lt;&#x2F;tx:method&gt;</span><br><span class="line">            &lt;tx:method name&#x3D;&quot;find*&quot; propagation&#x3D;&quot;SUPPORTS&quot; read-only&#x3D;&quot;true&quot;&gt;&lt;&#x2F;tx:method&gt;</span><br><span class="line">        &lt;&#x2F;tx:attributes&gt;</span><br><span class="line">    &lt;&#x2F;tx:advice&gt;</span><br><span class="line">&lt;!--配置AOP--&gt;</span><br><span class="line">&lt;aop:config&gt;</span><br><span class="line">&lt;!--    配置切入点表达式--&gt;</span><br><span class="line">    &lt;aop:pointcut id&#x3D;&quot;pt1&quot; expression&#x3D;&quot;execution(* com.itheima.service.impl.*.*(..))&quot;&gt;&lt;&#x2F;aop:pointcut&gt;</span><br><span class="line">&lt;!--    建立切入点表达式和事务通知的对应关系--&gt;</span><br><span class="line">    &lt;aop:advisor advice-ref&#x3D;&quot;txAdvice&quot; pointcut-ref&#x3D;&quot;pt1&quot;&gt;&lt;&#x2F;aop:advisor&gt;</span><br><span class="line">&lt;&#x2F;aop:config&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&lt;&#x2F;beans&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure>


<ul>
<li>spring基于注解的声明式事务控制</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version&#x3D;&quot;1.0&quot; encoding&#x3D;&quot;UTF-8&quot;?&gt;</span><br><span class="line">&lt;beans xmlns&#x3D;&quot;http:&#x2F;&#x2F;www.springframework.org&#x2F;schema&#x2F;beans&quot;</span><br><span class="line">       xmlns:xsi&#x3D;&quot;http:&#x2F;&#x2F;www.w3.org&#x2F;2001&#x2F;XMLSchema-instance&quot;</span><br><span class="line">       xmlns:aop&#x3D;&quot;http:&#x2F;&#x2F;www.springframework.org&#x2F;schema&#x2F;aop&quot;</span><br><span class="line">       xmlns:tx&#x3D;&quot;http:&#x2F;&#x2F;www.springframework.org&#x2F;schema&#x2F;tx&quot;</span><br><span class="line">       xmlns:context&#x3D;&quot;http:&#x2F;&#x2F;www.springframework.org&#x2F;schema&#x2F;context&quot;</span><br><span class="line">       xsi:schemaLocation&#x3D;&quot;</span><br><span class="line">        http:&#x2F;&#x2F;www.springframework.org&#x2F;schema&#x2F;beans</span><br><span class="line">        http:&#x2F;&#x2F;www.springframework.org&#x2F;schema&#x2F;beans&#x2F;spring-beans.xsd</span><br><span class="line">        http:&#x2F;&#x2F;www.springframework.org&#x2F;schema&#x2F;tx</span><br><span class="line">        http:&#x2F;&#x2F;www.springframework.org&#x2F;schema&#x2F;tx&#x2F;spring-tx.xsd</span><br><span class="line">        http:&#x2F;&#x2F;www.springframework.org&#x2F;schema&#x2F;aop</span><br><span class="line">        http:&#x2F;&#x2F;www.springframework.org&#x2F;schema&#x2F;aop&#x2F;spring-aop.xsd</span><br><span class="line">        http:&#x2F;&#x2F;www.springframework.org&#x2F;schema&#x2F;context</span><br><span class="line">        http:&#x2F;&#x2F;www.springframework.org&#x2F;schema&#x2F;context&#x2F;spring-context.xsd&quot;&gt;</span><br><span class="line">    </span><br><span class="line">&lt;!--    配置spring创建容器时要扫描的包--&gt;</span><br><span class="line">    &lt;context:component-scan base-package&#x3D;&quot;com.itheima&quot;&gt;&lt;&#x2F;context:component-scan&gt;</span><br><span class="line">    </span><br><span class="line">    &lt;!--配置jdbctemplate--&gt;</span><br><span class="line">    &lt;bean id&#x3D;&quot;jdbcTemplate&quot; class&#x3D;&quot;org.springframework.jdbc.core.JdbcTemplate&quot;&gt;</span><br><span class="line">        &lt;property name&#x3D;&quot;dataSource&quot; ref&#x3D;&quot;dataSource&quot;&gt;&lt;&#x2F;property&gt;</span><br><span class="line">    &lt;&#x2F;bean&gt;</span><br><span class="line"></span><br><span class="line">    &lt;!-- 配置数据源--&gt;</span><br><span class="line">    &lt;bean id&#x3D;&quot;dataSource&quot; class&#x3D;&quot;org.springframework.jdbc.datasource.DriverManagerDataSource&quot;&gt;</span><br><span class="line">        &lt;property name&#x3D;&quot;driverClassName&quot; value&#x3D;&quot;com.mysql.jdbc.Driver&quot;&gt;&lt;&#x2F;property&gt;</span><br><span class="line">        &lt;property name&#x3D;&quot;url&quot; value&#x3D;&quot;jdbc:mysql:&#x2F;&#x2F;localhost:3306&#x2F;eesy&quot;&gt;&lt;&#x2F;property&gt;</span><br><span class="line">        &lt;property name&#x3D;&quot;username&quot; value&#x3D;&quot;root&quot;&gt;&lt;&#x2F;property&gt;</span><br><span class="line">        &lt;property name&#x3D;&quot;password&quot; value&#x3D;&quot;root&quot;&gt;&lt;&#x2F;property&gt;</span><br><span class="line">    &lt;&#x2F;bean&gt;</span><br><span class="line"></span><br><span class="line">&lt;!--    spring中基于注解的声明式事务控制配置步骤</span><br><span class="line">    1.配置事务管理器</span><br><span class="line">    2.开启spring对注解事务的支持</span><br><span class="line">    3.在需要使用事务支持的地方使用@Transaction注解</span><br><span class="line">--&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&lt;!--配置事务管理器--&gt;</span><br><span class="line">&lt;bean id&#x3D;&quot;transactionManager&quot; class&#x3D;&quot;org.springframework.jdbc.datasource.DataSourceTransactionManager&quot;&gt;</span><br><span class="line">    &lt;property name&#x3D;&quot;dataSource&quot; ref&#x3D;&quot;dataSource&quot;&gt;&lt;&#x2F;property&gt;</span><br><span class="line">&lt;&#x2F;bean&gt;</span><br><span class="line"></span><br><span class="line">&lt;!--    2.开启spring对注解事务的支持--&gt;</span><br><span class="line">&lt;tx:annotation-driven transaction-manager&#x3D;&quot;transactionManager&quot;&gt;&lt;&#x2F;tx:annotation-driven&gt;</span><br><span class="line">&lt;&#x2F;beans&gt;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>业务层</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line">package com.itheima.service.impl;</span><br><span class="line"></span><br><span class="line">import com.itheima.dao.IAccountDao;</span><br><span class="line">import com.itheima.domain.Account;</span><br><span class="line">import com.itheima.service.IAccountService;</span><br><span class="line">import org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line">import org.springframework.stereotype.Service;</span><br><span class="line">import org.springframework.transaction.annotation.Propagation;</span><br><span class="line">import org.springframework.transaction.annotation.Transactional;</span><br><span class="line"></span><br><span class="line">import java.util.List;</span><br><span class="line"></span><br><span class="line">&#x2F;**</span><br><span class="line"> * 账户的业务层实现类</span><br><span class="line"> *</span><br><span class="line"> * 事务控制应该都是在业务层</span><br><span class="line"> *&#x2F;</span><br><span class="line">@Service(&quot;accountService&quot;)</span><br><span class="line">@Transactional(propagation &#x3D; Propagation.SUPPORTS ,readOnly &#x3D; true)</span><br><span class="line">&#x2F;&#x2F;这里如果每个方法要求不一样，则每个方法都要配置，比较麻烦</span><br><span class="line">public class AccountServiceImpl implements IAccountService&#123;</span><br><span class="line">    @Autowired</span><br><span class="line">    private IAccountDao accountDao;</span><br><span class="line"></span><br><span class="line">    public Account findAccountById(Integer accountId) &#123;</span><br><span class="line">        return accountDao.findAccountById(accountId);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    @Transactional(propagation &#x3D; Propagation.REQUIRED ,readOnly &#x3D; false)</span><br><span class="line">    public void transfer(String sourceName, String targetName, Float money) &#123;</span><br><span class="line">        System.out.println(&quot;transfer....&quot;);</span><br><span class="line">            &#x2F;&#x2F;2.1根据名称查询转出账户</span><br><span class="line">            Account source &#x3D; accountDao.findAccountByName(sourceName);</span><br><span class="line">            &#x2F;&#x2F;2.2根据名称查询转入账户</span><br><span class="line">            Account target &#x3D; accountDao.findAccountByName(targetName);</span><br><span class="line">            &#x2F;&#x2F;2.3转出账户减钱</span><br><span class="line">            source.setMoney(source.getMoney()-money);</span><br><span class="line">            &#x2F;&#x2F;2.4转入账户加钱</span><br><span class="line">            target.setMoney(target.getMoney()+money);</span><br><span class="line">            &#x2F;&#x2F;2.5更新转出账户</span><br><span class="line">            accountDao.updateAccount(source);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">            &#x2F;&#x2F;2.6更新转入账户</span><br><span class="line">            accountDao.updateAccount(target);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>
      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2020/02/04/Spring%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/" data-id="cke24uzy3000vq0uabwq3gulv" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Spring/" rel="tag">Spring</a></li></ul>

    </footer>
  </div>
  
    
<nav id="article-nav">
  
    <a href="/2020/03/16/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E7%AC%94%E8%AE%B0/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Newer</strong>
      <div class="article-nav-title">
        
          计算机网络笔记
        
      </div>
    </a>
  
  
    <a href="/2019/10/04/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BB%84%E6%88%90%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0-1/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Older</strong>
      <div class="article-nav-title">计算机组成原理学习笔记(1)</div>
    </a>
  
</nav>

  
</article>

</section>
        
          <aside id="sidebar">
  
    

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tags</h3>
    <div class="widget">
      <ul class="tag-list" itemprop="keywords"><li class="tag-list-item"><a class="tag-list-link" href="/tags/Green-MD%E5%9F%BA%E7%A1%80%E8%AF%AD%E6%B3%95/" rel="tag">Green MD基础语法</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/JAVA%E8%AF%AD%E8%A8%80%E5%9F%BA%E7%A1%80/" rel="tag">JAVA语言基础</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Java%E7%A8%8B%E5%BA%8F%E6%B5%81%E7%A8%8B%E6%8E%A7%E5%88%B6/" rel="tag">Java程序流程控制</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Spring/" rel="tag">Spring</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%B8%B8%E7%94%A8%E7%B1%BB/" rel="tag">常用类</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%95%B0%E7%BB%84%E4%B8%8E%E6%96%B9%E6%B3%95/" rel="tag">数组与方法</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E9%9D%A2%E5%90%91%E5%AF%B9%E8%B1%A1%E8%AE%BE%E8%AE%A1/" rel="tag">面向对象设计</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E9%9D%A2%E5%90%91%E5%AF%B9%E8%B1%A1%E8%AE%BE%E8%AE%A1%E5%9F%BA%E7%A1%80/" rel="tag">面向对象设计基础</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tag Cloud</h3>
    <div class="widget tagcloud">
      <a href="/tags/Green-MD%E5%9F%BA%E7%A1%80%E8%AF%AD%E6%B3%95/" style="font-size: 10px;">Green MD基础语法</a> <a href="/tags/JAVA%E8%AF%AD%E8%A8%80%E5%9F%BA%E7%A1%80/" style="font-size: 10px;">JAVA语言基础</a> <a href="/tags/Java%E7%A8%8B%E5%BA%8F%E6%B5%81%E7%A8%8B%E6%8E%A7%E5%88%B6/" style="font-size: 10px;">Java程序流程控制</a> <a href="/tags/Spring/" style="font-size: 10px;">Spring</a> <a href="/tags/%E5%B8%B8%E7%94%A8%E7%B1%BB/" style="font-size: 10px;">常用类</a> <a href="/tags/%E6%95%B0%E7%BB%84%E4%B8%8E%E6%96%B9%E6%B3%95/" style="font-size: 10px;">数组与方法</a> <a href="/tags/%E9%9D%A2%E5%90%91%E5%AF%B9%E8%B1%A1%E8%AE%BE%E8%AE%A1/" style="font-size: 10px;">面向对象设计</a> <a href="/tags/%E9%9D%A2%E5%90%91%E5%AF%B9%E8%B1%A1%E8%AE%BE%E8%AE%A1%E5%9F%BA%E7%A1%80/" style="font-size: 10px;">面向对象设计基础</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/08/">August 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/06/">June 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/03/">March 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/02/">February 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/10/">October 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/08/">August 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/07/">July 2019</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2020/08/19/hello-world/">Hello World</a>
          </li>
        
          <li>
            <a href="/2020/06/22/Git%E5%AD%A6%E4%B9%A0/">Git学习</a>
          </li>
        
          <li>
            <a href="/2020/03/16/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E7%AC%94%E8%AE%B0/">计算机网络笔记</a>
          </li>
        
          <li>
            <a href="/2020/02/04/Spring%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/">Spring学习笔记</a>
          </li>
        
          <li>
            <a href="/2019/10/04/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BB%84%E6%88%90%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0-1/">计算机组成原理学习笔记(1)</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2020 John Doe<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    

<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  
<link rel="stylesheet" href="/fancybox/jquery.fancybox.css">

  
<script src="/fancybox/jquery.fancybox.pack.js"></script>




<script src="/js/script.js"></script>




  </div>
</body>
</html>